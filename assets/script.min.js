"use strict";const pathDelimiter="/";const sectionDelimiter=":";const footnoteDelimiter="^";const menuCollapseWidth=768;const Tags={"in-progress":"warning",done:"success",abandoned:"black"};const AnchorScroll={interval:null,scrollTop:0,iterations:0};let STLViewerLibsLoaded=false;const STLViewerLibs=["assets/three.min.js","assets/STLLoader.min.js","assets/Detector.min.js","assets/OrbitControls.min.js"];const Request={path:[],section:null,footnote:null,parse:function(requestParameter){if(requestParameter.indexOf("#")===0){requestParameter=requestParameter.substr(1)}let tmp=requestParameter.split(footnoteDelimiter);this.footnote=tmp[1]||null;tmp=tmp[0].split(sectionDelimiter);this.section=tmp[1]||null;this.path=String(tmp[0]).split(pathDelimiter);return this},buildPath:function(){return this.path.join(pathDelimiter)},buildSection:function(){return this.buildPath()+sectionDelimiter+this.section},buildFootnote:function(){return this.buildPath()+footnoteDelimiter+this.footnote}};const ScriptLoader={loadArray:function(scripts){scripts.reverse();return new Promise((resolve,reject)=>{this._recursiveLoad(scripts,resolve,reject)})},_recursiveLoad:function(scriptFiles,resolve,reject){const scriptFile=scriptFiles.pop();if(typeof scriptFile==="undefined"){resolve();return}const script=document.createElement("script");script.onload=function(){ScriptLoader._recursiveLoad(scriptFiles,resolve,reject)};script.onerror=function(){reject(`unable to loader ${scriptFile}`)};script.src=scriptFile+"?"+(new Date).getTime();document.head.appendChild(script)}};const RenderFrame={heightFix:-10,content:null,path:null,scene:null,camera:null,renderer:null,init:function(path,content){this.content=content;this.path=path;this.scene=new THREE.Scene;this.scene.add(new THREE.AmbientLight(10066329));this.camera=new THREE.PerspectiveCamera(35,window.innerWidth/window.innerHeight,1,500);this.camera.up.set(0,0,1);this.camera.position.set(0,-9,6);this.camera.add(new THREE.PointLight(16777215,.8));this.scene.add(this.camera);const grid=new THREE.GridHelper(25,50,16777215,5592405);grid.rotateOnAxis(new THREE.Vector3(1,0,0),90*(Math.PI/180));this.scene.add(grid);this.renderer=new THREE.WebGLRenderer({antialias:true});this.renderer.setClearColor(10066329);this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setSize(this.content.clientWidth,this.content.clientHeight+this.heightFix);const loader=new THREE.STLLoader;const material=new THREE.MeshPhongMaterial({color:925765,specular:1118481,shininess:200});loader.load(this.path,geometry=>{const mesh=new THREE.Mesh(geometry,material);mesh.position.set(0,0,0);mesh.rotation.set(0,0,0);mesh.scale.set(.04,.04,.04);mesh.castShadow=true;mesh.receiveShadow=true;this.scene.add(mesh);this.renderer.render(this.scene,this.camera)});const controls=new THREE.OrbitControls(this.camera,this.renderer.domElement);controls.addEventListener("change",()=>{this.renderer.render(this.scene,this.camera)});controls.target.set(0,1.2,0);controls.update();window.addEventListener("resize",()=>{this.camera.aspect=window.innerWidth/window.innerHeight;this.camera.updateProjectionMatrix();this.renderer.setSize(this.content.clientWidth,this.content.clientHeight+this.heightFix);this.renderer.render(this.scene,this.camera)},false);content.innerHTML="";content.appendChild(this.renderer.domElement)}};const Menu={constructor(){Menu.collapsable=false},render:function(postIndex){const addSubNode=(prefix,pathArr)=>{const nodeName=pathArr.shift();let path=nodeName;let hasPrefix=false;if(prefix.length>0&&prefix[0].length>0){path=prefix.join("/")+"/"+path;hasPrefix=true}if(document.querySelector(`a[href="#${path}"]`)===null){let target="#menuList";if(hasPrefix){target+=` ul[data-id="${prefix.join("/")}"]`;if(document.querySelector(target)===null){document.querySelector(`li[data-id="${prefix.join("/")}"]`).innerHTML+=`<ul data-id="${prefix.join("/")}"></ul>`}}document.querySelector(target).innerHTML+=this._newMenuNode(path,nodeName)}if(pathArr.length>0&&pathArr[0].length>0){prefix.push(nodeName);addSubNode(prefix,pathArr)}};postIndex.forEach(post=>{addSubNode([],post.split("/"))})},setCollapsable:function(state){Menu.collapsable=state;document.querySelector("aside.menu p.menu-label span.collapsable").classList.toggle("is-hidden",!state);Menu.toggleCollapse(state)},checkCollapsable:function(){if(document.body.clientWidth<menuCollapseWidth){Menu.setCollapsable(true)}},toggleCollapse:function(state){if(Menu.collapsable||state===false){document.getElementById("menuList").classList.toggle("collapsed",state);document.querySelector("aside.menu span.collapsable").classList.toggle("collapsed",state)}},_newMenuNode:function(link,title){return`<li data-id="${link}"><a href="#${link}">&raquo;&nbsp;${title.split("_").join(" ")}</a></li>`}};const Router={route:function(){Request.parse(window.location.hash);let firstElement="";if(Request.path.length>0){firstElement=Request.path[0]}SetActiveMenuItem(Request.path);if(firstElement===""){window.location.hash="#latest";return}if(firstElement==="latest"){RenderRecentlyUpdatedAction();return}RenderPostAction("posts/"+Request.buildPath()+".md")}};const markdownRenderer=window.markdownit().use(window.markdownitFootnote).use(window.markdownitFootnoteBulma(Request)).use(window.markdownItAttrs).use(window.markdownitTags(Tags));document.addEventListener("DOMContentLoaded",()=>{window.addEventListener("hashchange",e=>{const newRequest=new Request.parse(e.newURL.split("#")[1]);if(newRequest.path.join(pathDelimiter)===Request.path.join(pathDelimiter)){return}Router.route()},false);window.addEventListener("scroll",(function(e){document.getElementById("scrolltop").classList.toggle("scrolltop-hidden",e.target.scrollingElement.scrollTop<e.target.scrollingElement.clientHeight)}));window.addEventListener("resize",(function(){if(document.body.clientWidth<menuCollapseWidth&&!Menu.collapsable){Menu.setCollapsable(true)}else if(document.body.clientWidth>=menuCollapseWidth&&Menu.collapsable){Menu.setCollapsable(false)}}));document.querySelector("aside.menu p.menu-label").addEventListener("click",()=>{Menu.toggleCollapse()});HttpGetRequest("post_index.json").then(postIndexData=>{const postIndex=JSON.parse(postIndexData);Menu.render(postIndex)}).finally(()=>{Router.route()});InitIcons();Menu.checkCollapsable()});function HttpGetRequest(url){return new Promise((resolve,reject)=>{const xhr=new XMLHttpRequest;xhr.onload=()=>{if(xhr.status>=200&&xhr.status<300){resolve(xhr.responseText)}else{reject(xhr.status)}};xhr.onerror=()=>{console.error(xhr);reject("unknown error")};xhr.open("GET",url+"?"+(new Date).getTime(),true);xhr.send()})}function RenderRecentlyUpdatedAction(){ShowContentContainer("loading");HttpGetRequest("updates.json").then(updateData=>{renderUpdates(JSON.parse(updateData),document.getElementById("main-container"));ShowContentContainer("main");InitRecentlyUpdatedListeners()}).catch(error=>{console.error(error);SetMessageBox("danger","Unknown error","Please try reloading the page");ShowContentContainer("message")})}function RenderPostAction(mdPath){ShowContentContainer("loading");HttpGetRequest(mdPath).then(markdownData=>{SetMainContent(markdownRenderer.render(markdownData));AddHeadlineIndex();ShowContentContainer("main");if(Request.section!==null){ScrollToAnchor(Request.buildSection())}else if(Request.footnote!==null){ScrollToAnchor(Request.buildFootnote())}InitPostListeners()}).catch(error=>{if(error===404){SetMessageBox("warning","Page not found","The Page could not be found, please try again");ShowContentContainer("message");return}console.error(error);SetMessageBox("danger","Unknown error","Please try reloading the page");ShowContentContainer("message")})}function ShowContentContainer(type){const contentContainers=document.getElementsByClassName("content-container");Array.prototype.forEach.call(contentContainers,contentContainer=>contentContainer.classList.add("is-hidden"));document.getElementById(type+"-container").classList.remove("is-hidden")}function SetMainContent(content){document.getElementById("main-container").innerHTML=content}function AddHeadlineIndex(){const contentContainer=document.getElementById("main-container");const headlines=contentContainer.querySelectorAll("h2,h3,h4,h5,h6");if(headlines.length<1){return}const headlineIndexContainer=document.createElement("div");headlineIndexContainer.classList.add("column","is-one-fifth","custom-box","headline-index-container");let htmlContent="<ul>";headlines.forEach(headline=>{htmlContent+=`<li><a href="#${headline.id}">${headline.innerText}</a></li>`});htmlContent+="</ul>";headlineIndexContainer.innerHTML=htmlContent;contentContainer.prepend(headlineIndexContainer)}function InitRecentlyUpdatedListeners(){document.querySelectorAll("span.show-diff").forEach(el=>{el.addEventListener("click",e=>{e.target.parentNode.classList.add("is-hidden");e.target.parentNode.parentNode.classList.remove("preview")})});document.querySelectorAll("div.diff-hide span").forEach(el=>{el.addEventListener("click",e=>{e.target.parentNode.parentNode.querySelector(".diff-overlay").classList.remove("is-hidden");e.target.parentNode.parentNode.classList.add("preview")})})}function InitPostListeners(){document.querySelectorAll('a[data-toggle="3d-preview"]').forEach(el=>{el.addEventListener("click",e=>{e.preventDefault();OpenViewSTLModal(e.target.getAttribute("href"))})})}function OpenViewSTLModal(path){LoadSTLViewerLibs(()=>{const preview3D=document.getElementById("STLViewerModal");preview3D.classList.add("is-active");RenderFrame.init(path,preview3D.querySelector(".modal-content"))})}function LoadSTLViewerLibs(cb){if(!STLViewerLibsLoaded){const overlayLoader=document.getElementById("overlay-loader");overlayLoader.classList.remove("is-hidden");ScriptLoader.loadArray(STLViewerLibs).then(cb).catch(err=>{alert(`Unable to loadArray STL Viewer: ${err}`)}).finally(()=>{overlayLoader.classList.add("is-hidden")});STLViewerLibsLoaded=true;return}cb()}function SetMessageBox(type,title,body){document.querySelector("#message-container").classList.remove(["is-dark","is-primary","is-link","is-info","is-success","is-warning","is-danger"]);document.querySelector("#message-container").classList.add("is-"+type);document.querySelector("#message-container .message-header > p").innerHTML=title;document.querySelector("#message-container .message-body").innerHTML=body}function SetActiveMenuItem(routes){let routeCombination=[];let routeSet=[];for(let i=0;i<routes.length;i++){routeCombination.push(routes[i]);routeSet.push(routeCombination.join(pathDelimiter))}document.querySelectorAll("#menuList li a").forEach(a=>a.classList.toggle("is-active",routeSet.indexOf(a.hash.substr(1))!==-1))}function ScrollToAnchor(id){const targetElement=document.getElementById(decodeURIComponent(id));if(!targetElement){return}AnchorScroll.iterations=0;AnchorScroll.scrollTop=0;AnchorScroll.interval=setInterval(()=>{AnchorScroll.iterations++;if(AnchorScroll.iterations>10){clearInterval(AnchorScroll.interval)}if(AnchorScroll.scrollTop<targetElement.offsetTop){(document.scrollingElement||document.documentElement).scrollTop=targetElement.offsetTop;AnchorScroll.scrollTop=targetElement.offsetTop}},100)}function InitIcons(){document.querySelectorAll("i[data-icon]").forEach(elem=>{const iconPath=`assets/fontawesome/svgs/${elem.getAttribute("data-icon")}.svg`;HttpGetRequest(iconPath).then(svg=>{elem.innerHTML=svg})})}function renderUpdates(updates,target){target.innerHTML="";let keys=[];for(let key in updates){if(updates.hasOwnProperty(key)){keys.push(key)}}keys.sort((a,b)=>b-a).forEach(key=>{let items="";updates[key].forEach(item=>{let path_parts=item["path"].slice(0,-3).split(":");items+=`<p><a href="#${path_parts[path_parts.length-1]}">${item["path"].replace(":","&nbsp;&rarr;&nbsp;")}</a>`;switch(item["change"]){case"new":items+='&nbsp;<span class="tag is-success"> new </span>';break;case"deleted":items+='&nbsp;<span class="tag is-danger"> deleted </span>';break;case"renamed":items+='&nbsp;<span class="tag is-primary"> renamed </span>';break;case"content":items+='&nbsp;<span class="tag is-primary"> updated </span>';break}items+=`<br><div class="column custom-box diff preview" data-key="${key}" data-path="${item["path"]}"><div class="diff-content"></div><div class="diff-hide"><span>Hide</span></div><div class="diff-overlay"><span class="show-diff">Show diff</span></div></div></p>`});target.innerHTML+=`<section class="section update-section">\n<h1 class="title">${new Date(key*1e3).toLocaleString()}</h1>\n<hr>\n<div>\n${items}\n</div>\n</section>`;HttpGetRequest("update_diffs/"+key+".json").then(diffData=>{JSON.parse(diffData).forEach(diff=>{const target=document.querySelector(`div[data-key="${key}"][data-path="${diff.path}"] div.diff-content`);target.innerHTML=diff.diff.replace(/^\+(.*?)$/gm,'<span class="has-text-success">+$1</span>').replace(/^-(.*?)$/gm,'<span class="has-text-danger">-$1</span>')})}).catch(error=>{console.error(error);document.querySelectorAll(`div[data-key="${key}"]`).forEach(elem=>{elem.innerHTML="error loading (see logs)"})})})}